<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario Imoveis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
        body {
            font-family: helvetica-w01-roman, helvetica-w02-roman, helvetica-lt-w10-roman, sans-serif;
            margin-bottom: 50px;
            display: flex;
            margin-left: 20px;
            align-items: left;
        }

        .title {
            text-align: center;
        }

        .final-button {
            margin-top: 60px;
            text-align: center;
        }

        /*.final-button:hover {
            background-color: #ffffff;
        }*/

        #carregamento {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            /* Opção de fundo escuro */
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .dot {
            animation: blink 1.5s steps(1, end) infinite;
        }

        .dot:nth-child(2) {
            animation-delay: 0.5s;
        }

        .dot:nth-child(3) {
            animation-delay: 1s;
        }

        @keyframes blink {

            0%,
            20% {
                color: transparent;
            }

            40% {
                color: black;
            }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</head>

<body>

    <div class="container p-5" id="form-div">
        <form class="row g-3" id="form-init">
            <div class="mb-3 col-md-12">
                <div class="mb-3 col-md-4" id="cep_display">
                    <label for="text" class="form-label">CEP *</label>
                    <input type="cep" id="cep" class="form-control border border-black rounded-0"
                        placeholder="00001-000" required>
                </div>

                <div class="mb-3 col-md-2" style="display: none;">
                    <div class="form-check">
                        <input type="checkbox" id="naoseicep" class="form-check-input border border-black">
                        <label for="text" class="form-text-label">Não sei o CEP</label>
                    </div>
                </div>
            </div>

            <div class="row" style="display: none;" id="endereco_completo">
                <div class="col-md-4">
                    <label for="text" class="form-text-label mb-2">Estado *</label>
                    <select class="form-select border border-black rounded-0" aria-label="Default select example"
                        id="estado">
                        <option selected></option>
                        <option value="ac">AC</option>
                        <option value="al">AL</option>
                        <option value="ap">AP</option>
                        <option value="am">AM</option>
                        <option value="ba">BA</option>
                        <option value="ce">CE</option>
                        <option value="df">DF</option>
                        <option value="es">ES</option>
                        <option value="go">GO</option>
                        <option value="ma">MA</option>
                        <option value="mt">MT</option>
                        <option value="ms">MS</option>
                        <option value="mg">MG</option>
                        <option value="pa">PA</option>
                        <option value="pb">PB</option>
                        <option value="pr">PR</option>
                        <option value="pe">PE</option>
                        <option value="pi">PI</option>
                        <option value="rj">RJ</option>
                        <option value="rn">RN</option>
                        <option value="rs">RS</option>
                        <option value="ro">RO</option>
                        <option value="rr">RR</option>
                        <option value="sc">SC</option>
                        <option value="sp">SP</option>
                        <option value="se">SE</option>
                        <option value="to">TO</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="text" class="form-label">Cidade *</label>
                    <input type="cidade" id="cidade" class="form-control border border-black rounded-0">
                </div>
                <div class="col-md-4">
                    <label for="text" class="form-label">Bairro *</label>
                    <input type="bairro" id="bairro" class="form-control border border-black rounded-0" required>
                </div>
                <div class="col-md-4">
                    <label for="text" class="form-label mt-3">Logradouro *</label>
                    <input type="logradouro" id="logradouro" class="form-control border border-black rounded-0"
                        required>
                </div>
                <div class="col-md-4">
                    <label for="text" class="form-label mt-3">Número *</label>
                    <input type="numero" id="numero" class="form-control border border-black rounded-0" required>
                </div>
            </div>

            <div class="col-md-6 ">
                <div class="mb-3 ">
                    <label class="mb-3" id="label_tipo_imovel">Tipo de Imóvel *</label>

                    <div class="form-check">
                        <input class="form-check-input border border-black tipoimovel" type="radio" name="tipoDeImovel"
                            id="tipoimovel" value="apartamento">
                        <label class="form-check-label" for="tipo1.1">Apartamento</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input border border-black tipoimovel" type="radio" name="tipoDeImovel"
                            id="tipoimovel" value="casa">
                        <label class="form-check-label" for="casa">Casa</label>
                    </div>

                </div>
            </div>

            <div class="col-md-6">
                <div class="mb-3">
                    <label class="mb-3" id="label_tipo_transc">Tipo de Transação *</label>

                    <div class="form-check">
                        <input class="form-check-input border border-black tipotransacao" type="radio"
                            name="tipoDeTransacao" id="" value="venda" required>
                        <label class="form-check-label" for="tipo1.1">Venda</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input border border-black tipotransacao" type="radio"
                            name="tipoDeTransacao" id="" value="locacao" required>
                        <label class="form-check-label" for="casa">Locação</label>
                    </div>

                </div>
            </div>

            <div class="col-md-6">
                <label for="areautil" class="form-label">Área útil *</label>
                <input type="text" class="form-control required border border-black rounded-0" id="areautil" required>
            </div>

            <div class="col-md-6">
                <label for="anoconstrucao" class="form-label">Ano de contrução *</label>
                <input type="text" class="form-control border border-black rounded-0" id="anocontrucao" required>
            </div>

            <div class="col-md-6">
                <label for="dormitorio" class="form-label">Dormitórios *</label>
                <input type="text" class="form-control border border-black rounded-0" id="dormitorio">
            </div>

            <div class="col-md-6">
                <label for="suites" class="form-label">Suites *</label>
                <input type="text" class="form-control border border-black rounded-0" id="suites">
            </div>

            <div class="col-md-6">
                <label for="banheiros" class="form-label">Banheiros *</label>
                <input type="text" class="form-control border border-black rounded-0" id="banheiros">
            </div>

            <div class="col-md-6">
                <label for="vagas" class="form-label">Vagas *</label>
                <input type="text" class="form-control border border-black rounded-0" id="vagas">
            </div>

            <div class="final-button d-grid gap-2 col-6 mx-auto">
                <button type="button" class="btn btn-secondary rounded-0" onclick="enviar()">Enviar</button>
            </div>

        </form>

        <div id="carregamento">
            <div class="spinner"></div>
            <p style="margin-top: 20px; font-size: 18px; color: #0434b8;"><span id="texto-carregamento"></span><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>
            </p>
        </div>

        <div id="resposta" class="container" style="display: none;">
            <div class="row">
                <div class="col-md-9"></div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-secondary" onclick="baixarInformacoes()">
                        Baixar Informações
                        <!-- <a id="baixar" href="" style="text-decoration: none;color: white;">Baixar Informações</a> -->
                    </button>

                    <button type="button" class="btn btn-secondary" onclick="voltarForm()"><a id="voltar"
                            style="text-decoration: none;color: white;">Voltar</a></button>
                </div>
            </div>

            <!-- <div class="col-md-12" id="interface-resposta"></div> -->
            <div class="row">
                <h3 style="color: green; font-weight: bold;">Características do seu imóvel</h3>
                <span style="font-size: 14pt;" id="endereco-resposta"></span>
            </div>

            <div class="row">
                <div class="col-md-3">
                    <i class="material-symbols-outlined">bed</i>
                    <span style="font-size: 14pt;" id="dormitorio-resposta"></span>
                </div>

                <div class="col-md-3">
                    <span class="material-symbols-outlined">bathtub</span>
                    <span style="font-size: 14pt;" id="banheiro-resposta"></span>
                </div>

                <div class="col-md-3">
                    <i class="material-symbols-outlined">garage</i>
                    <span style="font-size: 14pt;" id="vagas-resposta"></span>
                </div>

                <div class="col-md-3">
                    <i class="material-symbols-outlined">straighten</i>
                    <span style="font-size: 14pt;" id="areautil-resposta"></span>
                </div>
            </div>

            <div class="row">
                <span style="font-size:14pt"><strong>Ano da construção:</strong></span>
                <span style="font-size:14pt" id="anoconstrucao-resposta"></span>
            </div>

            <div class="row">
                <span style="font-size:14pt"><strong>Tipo do imóvel:</strong></span>
                <span style="font-size:14pt" id="tipoimovel-resposta"></span>
            </div>

            <div class="row">
                <h3 style="color: green;font-weight:bold;">Valores estimados</h3>
                <span style="font-size: 14pt;"><strong>Valor</strong></span>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <span style="font-size: 14pt;">Mín:</span>
                    <span id="min-resposta"></span>
                </div>
                <div class="col-md-4">
                    <span style="font-size: 14pt;">Cen:</span>
                    <span style="font-size: 14pt;" id="cen-resposta"></span>
                </div>
                <div class="col-md-4">
                    <span style="font-size: 14pt;">Máx:</span>
                    <span style="font-size: 14pt;" id="max-resposta"></span>
                </div>

                <div class="row">
                    <span style="font-size: 14pt;"><strong>Valor M²</strong></span>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <span style="font-size: 14pt;">Mín:</span>
                        <span style="font-size: 14pt;" id="min2-resposta"></span>
                    </div>
                    <div class="col-md-4">
                        <span style="font-size: 14pt;">Cen:</span>
                        <span style="font-size: 14pt;" id="cen2-resposta"></span>
                    </div>
                    <div class="col-md-4">
                        <span style="font-size: 14pt;">Máx:</span>
                        <span style="font-size: 14pt;" id="max2-resposta"></span>
                    </div>
                </div>

                <div id="table-resposta" class="row">
                    <h3 style="color: green; font-weight: bold;">Informações Imóveis Semelhantes</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Endereço</th>
                                    <th scope="col">Valor do anúncio</th>
                                    <th scope="col">Valor por m²</th>
                                    <th scope="col">Área m²</th>
                                    <th scope="col">Quartos</th>
                                    <th scope="col">Banheiros</th>
                                    <th scope="col">Suites</th>
                                    <th scope="col">Vagas</th>
                                    <th scope="col">Ano construção</th>
                                </tr>
                            </thead>
                            <tbody class="table-group-divider" id="tbody-table">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" tabindex="-1" id="modal_erro" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-danger">Erro</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                            onclick="closeModal()"></button>
                    </div>
                    <div class="modal-body">
                        <p id="corpo_erro_modal">campo texto</p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let excelobjreq = {}

            function closeModal() {
                document.getElementById("modal_erro").style.display = "none"
                document.getElementById("form-div").style.opacity = 1
            }

            document.addEventListener('DOMContentLoaded', function () {
                let cepInput = document.getElementById('cep');
                let areaUtil = document.getElementById('areautil');
                let anoConstrucao = document.getElementById('anocontrucao');
                let dormitorios = document.getElementById('dormitorio');
                let suites = document.getElementById('suites');
                let banheiros = document.getElementById('banheiros');
                let vagas = document.getElementById('vagas');

                cepInput.addEventListener('input', function (event) {
                    let value = event.target.value;
                    // Remove caracteres não numéricos, incluindo letras
                    value = value.replace(/\D/g, '');
                    // Insere o hífen após o quinto dígito
                    if (value.length > 5 && !/\-/g.test(value)) {
                        value = value.slice(0, 5) + '-' + value.slice(5);
                    } else if (value.length === 5 && /\//g.test(value)) {
                        value = value.replace(/\//g, '-'); // Corrige caso tenha sido inserido um slash em vez de um hífen
                    }
                    // Limita a entrada a 8 dígitos após o hífen
                    if (value.length > 9) {
                        value = value.slice(0, 8);
                    }
                    event.target.value = value;
                });

                areaUtil.addEventListener('input', function (event) {
                    const newValue = areaUtil.value.replace(/[^0-9.]/g, '');
                    areaUtil.value = newValue;
                })

                anoConstrucao.addEventListener('input', function (event) {
                    const newValue = anoConstrucao.value.replace(/[^0-9]/g, '');
                    anoConstrucao.value = newValue;
                })

                dormitorios.addEventListener('input', function (event) {
                    const newValue = dormitorios.value.replace(/[^0-9]/g, '');
                    dormitorios.value = newValue;
                })

                suites.addEventListener('input', function (event) {
                    const newValue = suites.value.replace(/[^0-9]/g, '');
                    suites.value = newValue;
                })

                banheiros.addEventListener('input', function (event) {
                    const newValue = banheiros.value.replace(/[^0-9]/g, '');
                    banheiros.value = newValue;
                })

                vagas.addEventListener('input', function (event) {
                    const newValue = vagas.value.replace(/[^0-9]/g, '');
                    vagas.value = newValue;
                })

                document.getElementById("naoseicep").addEventListener('change', () => {
                    if (document.getElementById("naoseicep").checked) {
                        document.getElementById("endereco_completo").style.display = "flex"
                        document.getElementById("cep_display").style.display = "none"
                    } else {
                        document.getElementById("endereco_completo").style.display = "none"
                        document.getElementById("cep_display").style.display = "block"
                    }
                })

            });

            async function enviar() {
                document.getElementById("cep").className = "form-control border border-black rounded-0"
                document.getElementById("estado").className = "form-select border rounded-0 border-black"
                document.getElementById("cidade").className = "form-control border border-black rounded-0"
                document.getElementById("bairro").className = "form-control border border-black rounded-0"
                document.getElementById("logradouro").className = "form-control border border-black rounded-0"
                document.getElementById("numero").className = "form-control border border-black rounded-0"
                document.getElementById('label_tipo_imovel').className = "mb-3 text-black"
                document.getElementById('label_tipo_transc').className = "mb-3 text-black"
                document.getElementById("areautil").className = "form-control required border rounded-0 border-black"
                document.getElementById("anocontrucao").className = "form-control required border rounded-0 border-black"
                document.getElementById("dormitorio").className = "form-control required border rounded-0 border-black"
                document.getElementById("suites").className = "form-control required border rounded-0 border-black"
                document.getElementById("banheiros").className = "form-control required border rounded-0 border-black"
                document.getElementById("vagas").className = "form-control required border rounded-0 border-black"

                let cep = document.getElementById("cep").value;
                let naosei = document.getElementById("naoseicep").checked;
                let estado = document.getElementById("estado").value;
                let cidade = document.getElementById("cidade").value;
                let bairro = document.getElementById("bairro").value;
                let logradouro = document.getElementById("logradouro").value;
                let numero = document.getElementById("numero").value;
                let tipoimovel = document.querySelectorAll(".tipoimovel");
                let tipotransacao = document.querySelectorAll(".tipotransacao");
                let areautil = document.getElementById("areautil").value;
                let anoconstrucao = document.getElementById("anocontrucao").value;
                let dormitorio = document.getElementById("dormitorio").value;
                let suites = document.getElementById("suites").value;
                let banheiros = document.getElementById("banheiros").value;
                let vagas = document.getElementById("vagas").value;

                if (naosei) {
                    if (estado.length == 0) {
                        document.getElementById("estado").className = "form-select border rounded-0 border-danger"
                        return;
                    }

                    if (cidade.length == 0) {
                        document.getElementById("cidade").className = "form-control border border-danger rounded-0"
                        return;
                    }

                    if (bairro.length == 0) {
                        document.getElementById("bairro").className = "form-control border border-danger rounded-0"
                        return;
                    }

                    if (logradouro.length == 0) {
                        document.getElementById("logradouro").className = "form-control border border-danger rounded-0"
                        return;
                    }

                    if (numero.length == 0) {
                        document.getElementById("numero").className = "form-control border border-danger rounded-0"
                        return;
                    }
                }

                if (!naosei && cep.length == 0) {
                    document.getElementById("cep").className = "form-control border border-danger rounded-0"
                    return;
                }

                if (!tipoimovel[0].checked && !tipoimovel[1].checked) {
                    document.getElementById("modal_erro").style.display = "flex"
                    document.getElementById("corpo_erro_modal").innerText = "Tipo imóvel não selecionado."
                    document.getElementById("form-div").style.opacity = 0.5
                    document.getElementById('label_tipo_imovel').className = "mb-3 text-danger"
                    return
                }

                if (!tipotransacao[0].checked && !tipotransacao[1].checked) {
                    document.getElementById("modal_erro").style.display = "flex"
                    document.getElementById("corpo_erro_modal").innerText = "Tipo transação não selecionado."
                    document.getElementById("form-div").style.opacity = 0.5
                    document.getElementById('label_tipo_transc').className = "mb-3 text-danger"
                    return
                }

                if (areautil.length == 0) {
                    document.getElementById("areautil").className = "form-control required border rounded-0 border-danger"
                    return;
                }

                if (anocontrucao.length == 0) {
                    document.getElementById("anocontrucao").className = "form-control required border rounded-0 border-danger"
                    return;
                }

                if (dormitorio.length == 0) {
                    document.getElementById("dormitorio").className = "form-control required border rounded-0 border-danger"
                    return;
                }

                if (suites.length == 0) {
                    document.getElementById("suites").className = "form-control required border rounded-0 border-danger"
                    return;
                }

                if (banheiros.length == 0) {
                    document.getElementById("banheiros").className = "form-control required border rounded-0 border-danger"
                    return;
                }

                if (vagas.length == 0) {
                    document.getElementById("vagas").className = "form-control required border rounded-0 border-danger"
                    return;
                }

                let tipoImovelValue = document.querySelectorAll(".tipoimovel")[0].checked ? "APARTAMENTO" : "CASA";
                let tipotransacaoValue = document.querySelectorAll(".tipotransacao")[0].checked ? "VENDA" : "LOCACAO"

                if (tipoImovelValue == "CASA" && tipotransacaoValue == "LOCACAO") {
                    document.getElementById("modal_erro").style.display = "flex"
                    document.getElementById("corpo_erro_modal").innerText = "Não foi aceito a consulta de LOCAÇÃO para o tipo de imóvel CASA."
                    document.getElementById("form-div").style.opacity = 0.5
                }

                document.getElementById('form-init').style.display = "none"
                document.getElementById('carregamento').style.display = "flex"
                document.getElementById('texto-carregamento').innerText = "Buscando"

                if (cep) {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const data = await response.json();

                    if (!naosei) {
                        bairro = data.bairro
                        cidade = data.localidade
                        logradouro = data.logradouro
                        estado = data.uf
                    }
                } else {
                    const response = await fetch(`https://viacep.com.br/ws/${estado}/${encodeURIComponent(cidade)}/${encodeURIComponent(logradouro)}/json/`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    // Função para encontrar a correspondência mais próxima
                    function findClosestMatch(userResponse, apiResponse) {
                        let closestMatch = null;
                        let closestDistance = Infinity;

                        apiResponse.forEach(location => {
                            const distance = levenshteinDistance(userResponse.toLowerCase(), location.bairro.toLowerCase());
                            if (distance < closestDistance) {
                                closestDistance = distance;
                                closestMatch = location;
                            }
                        });

                        return closestMatch;
                    }

                    // Função para calcular a distância de Levenshtein entre duas strings
                    function levenshteinDistance(a, b) {
                        const matrix = [];

                        for (let i = 0; i <= b.length; i++) {
                            matrix[i] = [i];
                        }

                        for (let j = 0; j <= a.length; j++) {
                            matrix[0][j] = j;
                        }

                        for (let i = 1; i <= b.length; i++) {
                            for (let j = 1; j <= a.length; j++) {
                                if (b.charAt(i - 1) === a.charAt(j - 1)) {
                                    matrix[i][j] = matrix[i - 1][j - 1];
                                } else {
                                    matrix[i][j] = Math.min(
                                        matrix[i - 1][j - 1] + 1,
                                        matrix[i][j - 1] + 1,
                                        matrix[i - 1][j] + 1
                                    );
                                }
                            }
                        }

                        return matrix[b.length][a.length];
                    }

                    // Encontrar e exibir a correspondência mais próxima
                    const closestMatch = findClosestMatch(bairro, data);

                    cep = closestMatch.cep

                    const responseInfoEndereco = await fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const dataEndereco = await responseInfoEndereco.json();

                    bairro = dataEndereco.bairro
                    cidade = dataEndereco.localidade
                    logradouro = dataEndereco.logradouro
                    estado = dataEndereco.uf

                }

                cep = cep.replace(/[^0-9]/g, '');

                const obj = {
                    cep: cep,
                    estado: estado.toUpperCase(),
                    cidade: cidade,
                    bairro: bairro,
                    logradouro: logradouro,
                    numero: parseInt(numero),
                    tipoimovel: tipoImovelValue,
                    tipotransacao: tipotransacaoValue,
                    areautil: parseFloat(areautil),
                    anoconstrucao: parseInt(anoconstrucao),
                    dormitorio: parseInt(dormitorio),
                    suites: parseInt(suites),
                    banheiros: parseInt(banheiros),
                    vagas: parseInt(vagas)
                }

                let urlApi = "https://fabio-formulario-avm.zvnqey.easypanel.host/doc"
                const response = await fetch(urlApi, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(obj)
                });

                const data = await response.json();


                if (data.status == 404) {
                    document.getElementById("modal_erro").style.display = "flex"
                    document.getElementById("corpo_erro_modal").innerText = "Erro ao processar dados, favor verificar os dados informados."
                    document.getElementById("form-div").style.opacity = 0.5
                    document.getElementById('form-init').style.display = "flex"
                    document.getElementById('carregamento').style.display = "none"
                    document.getElementById('resposta').style.display = "none"
                    return;
                }

                document.getElementById('carregamento').style.display = "none"
                document.getElementById('resposta').style.display = "block"

                excelobjreq = data.excelobj

                document.getElementById("endereco-resposta").innerText = `${logradouro}, ${bairro}, ${cidade} - ${estado}`
                document.getElementById("dormitorio-resposta").innerText = `${dormitorio} Quartos ${suites != null ? suites + ' suíte(s))' : ''}`
                document.getElementById("banheiro-resposta").innerText = `${banheiros} Banheiros`
                document.getElementById("vagas-resposta").innerText = `${vagas} Vagas`
                document.getElementById("areautil-resposta").innerText = `${areautil} m² (área útil)`
                document.getElementById("anoconstrucao-resposta").innerText = `${anoconstrucao}`
                document.getElementById("tipoimovel-resposta").innerText = `${tipoImovelValue.toUpperCase()}`
                document.getElementById("min-resposta").innerText = `${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(data.avm.min * areautil)}`
                document.getElementById("cen-resposta").innerText = `${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(data.avm.central * areautil)}`
                document.getElementById("max-resposta").innerText = `${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(data.avm.max * areautil)}`
                document.getElementById("min2-resposta").innerText = `${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(data.avm.min)}`
                document.getElementById("cen2-resposta").innerText = `${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(data.avm.central)}`
                document.getElementById("max2-resposta").innerText = `${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(data.avm.max)}`

                // Verifica se 'data.bros' existe e tem itens
                if (data && data.bros && data.bros.length > 0) {
                    const tbody = document.getElementById('tbody-table');

                    data.bros.forEach(bro => {
                        const row = document.createElement('tr');

                        // Cria e adiciona células à linha
                        [
                            'endereco', 'preco', 'preco_metro', 'area_util', 'dormitorios', 'banheiros', 'suites', 'vagas', 'ano_construcao'
                        ].forEach(key => {
                            let cellValue = bro[key] !== undefined ? bro[key] : '';

                            // Aplica formatação de moeda apenas para 'preco' e 'preco_metro'
                            if (key === 'preco' || key === 'preco_metro') {
                                const formattedValue = new Intl.NumberFormat('pt-BR',{ maximumFractionDigits: 0 }).format(cellValue);
                                // Concatena o símbolo "R$" manualmente
                                cellValue = 'R$ ' + formattedValue;
                            }

                            const cell = document.createElement('td');
                            cell.textContent = cellValue;
                            row.appendChild(cell);
                        });

                        tbody.appendChild(row);
                    });
                }
            }

            function voltarForm() {
                document.getElementById('resposta').style.display = "none"
                document.getElementById('form-init').style.display = "flex"
                document.getElementById("cep").value = '';
                document.getElementById("naoseicep").checked = false;
                document.getElementById("estado").value = '';
                document.getElementById("cidade").value = '';
                document.getElementById("bairro").value = '';
                document.getElementById("logradouro").value = '';
                document.getElementById("numero").value = '';
                document.querySelectorAll(".tipoimovel")[0].checked = false
                document.querySelectorAll(".tipoimovel")[1].checked = false;
                document.querySelectorAll(".tipotransacao")[0].checked = false;
                document.querySelectorAll(".tipotransacao")[1].checked = false
                document.getElementById("areautil").value = '';
                document.getElementById("anocontrucao").value = '';
                document.getElementById("dormitorio").value = '';
                document.getElementById("suites").value = '';
                document.getElementById("banheiros").value = '';
                document.getElementById("vagas").value = '';
            }

            async function baixarInformacoes() {
                document.getElementById('carregamento').style.display = "flex"
                document.getElementById('texto-carregamento').innerText = "Baixando"
                let urlApi = "https://fabio-formulario-avm.zvnqey.easypanel.host/excel"
                const response = await fetch(urlApi, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(excelobjreq)
                });

                const data = await response.json();

                window.location.href = data.link
                document.getElementById('carregamento').style.display = "none"
            }
        </script>

</body>

</html>